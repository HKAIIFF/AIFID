<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIFID - Unified Identity System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        * { 
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        .font-mono { font-family: 'Space Mono', monospace; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e5e5e5; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #999; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .submenu { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .submenu.open { max-height: 500px; }
        
        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        @keyframes scan {
            0%, 100% { top: 0; }
            50% { top: 100%; }
        }
        
        @media (max-width: 1024px) {
            #sidebar { transform: translateX(-100%); transition: transform 0.3s; }
            #sidebar.open { transform: translateX(0); }
        }

        .did-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
            aspect-ratio: 1.586;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card-pattern {
            position: absolute;
            top: 0;
            right: 0;
            width: 60%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, transparent 100%);
            border-radius: 50% 0 0 50%;
        }

        .card-pattern::before {
            content: '';
            position: absolute;
            top: 20%;
            right: 10%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.2) 0%, transparent 70%);
            border-radius: 50%;
        }

        .matrix-node {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .matrix-node:hover {
            border-color: #000;
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .matrix-node.filled {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .matrix-node.captain {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-color: #FFA500;
            color: #000;
        }

        .matrix-node.super {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border-color: #3b82f6;
        }

        .node-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .node-stats {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 12px;
            margin-top: 12px;
            width: 100%;
        }

        .transaction-item {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .transaction-item:hover {
            border-color: #000;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .asset-card {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 20px;
            padding: 28px;
            transition: all 0.3s;
        }

        .asset-card:hover {
            border-color: #000;
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.1);
        }

        .asset-card.highlight {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
            border-color: #FFA500;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 overflow-hidden">

    <!-- LOGIN VIEW -->
    <div id="login-view" class="fixed inset-0 z-50 bg-white flex items-center justify-center p-6">
        <div class="w-full max-w-md">
            <div class="text-center mb-10">
                <div class="inline-flex items-center gap-3 mb-6">
                    <div class="w-16 h-16 bg-black text-white flex items-center justify-center font-black text-2xl rounded-2xl">ID</div>
                    <span class="text-3xl font-black">AIFID</span>
                </div>
                <h1 class="text-5xl font-black mb-3" data-i18n="login.title">Unified Access</h1>
                <p class="text-gray-500" data-i18n="login.subtitle">Connect to the Ecosystem</p>
            </div>

            <!-- Email Login -->
            <div class="mb-6">
                <div class="relative">
                    <input 
                        type="email" 
                        id="email-input"
                        placeholder="Enter your email"
                        class="w-full px-6 py-4 border-2 border-gray-200 rounded-2xl focus:outline-none focus:border-black text-lg transition-all"
                    />
                    <i class="fas fa-envelope absolute right-6 top-1/2 -translate-y-1/2 text-gray-400 text-xl"></i>
                </div>
                <button 
                    onclick="loginWithEmail()"
                    class="w-full mt-3 py-4 bg-black text-white rounded-2xl font-black text-lg hover:bg-gray-900 transition-all"
                >
                    <span data-i18n="login.continueEmail">Continue with Email</span>
                </button>
            </div>

            <div class="flex items-center gap-4 mb-6">
                <div class="flex-1 h-px bg-gray-200"></div>
                <span class="text-sm text-gray-400 font-bold">OR</span>
                <div class="flex-1 h-px bg-gray-200"></div>
            </div>

            <!-- Wallet Login Options -->
            <div class="space-y-3">
                <button onclick="loginWithPhantom()" class="w-full p-5 border-2 border-gray-200 rounded-2xl hover:border-purple-500 hover:bg-purple-50 transition-all flex items-center justify-between group">
                    <span class="font-bold flex items-center gap-3">
                        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-ghost text-purple-600 text-xl"></i>
                        </div>
                        <span>Phantom Wallet</span>
                    </span>
                    <i class="fas fa-arrow-right opacity-0 group-hover:opacity-100 transition-opacity"></i>
                </button>
                
                <button onclick="loginWithMetaMask()" class="w-full p-5 border-2 border-gray-200 rounded-2xl hover:border-orange-500 hover:bg-orange-50 transition-all flex items-center justify-between group">
                    <span class="font-bold flex items-center gap-3">
                        <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                            <i class="fab fa-ethereum text-orange-500 text-xl"></i>
                        </div>
                        <span>MetaMask (Solana Snap)</span>
                    </span>
                    <i class="fas fa-arrow-right opacity-0 group-hover:opacity-100 transition-opacity"></i>
                </button>

                <button onclick="loginWithBinance()" class="w-full p-5 border-2 border-gray-200 rounded-2xl hover:border-yellow-500 hover:bg-yellow-50 transition-all flex items-center justify-between group">
                    <span class="font-bold flex items-center gap-3">
                        <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-wallet text-yellow-600 text-xl"></i>
                        </div>
                        <span>Binance Web3 Wallet</span>
                    </span>
                    <i class="fas fa-arrow-right opacity-0 group-hover:opacity-100 transition-opacity"></i>
                </button>
            </div>

            <div class="mt-8 text-center">
                <button onclick="toggleLanguage()" class="text-sm text-gray-500 hover:text-black font-bold">
                    <i class="fas fa-language mr-2"></i>
                    <span id="lang-btn">EN / 繁</span>
                </button>
            </div>

            <div class="mt-6 text-center text-xs text-gray-400">
                <p>By connecting, you agree to our Terms of Service</p>
            </div>
        </div>
    </div>

    <!-- EMAIL VERIFICATION MODAL -->
    <div id="email-verify-modal" class="fixed inset-0 z-[70] bg-black/80 hidden items-center justify-center p-6">
        <div class="bg-white rounded-3xl max-w-md w-full p-8">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-blue-50 rounded-2xl flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-envelope-open-text text-blue-600 text-3xl"></i>
                </div>
                <h2 class="text-3xl font-black mb-2">Check Your Email</h2>
                <p class="text-gray-600" id="sent-to-email">We sent a verification code to your email</p>
            </div>

            <div class="mb-6">
                <label class="text-sm font-bold mb-2 block">Verification Code</label>
                <input 
                    type="text" 
                    id="verify-code"
                    placeholder="Enter 6-digit code"
                    maxlength="6"
                    class="w-full px-6 py-4 border-2 border-gray-200 rounded-2xl focus:outline-none focus:border-black text-center text-2xl font-mono tracking-widest"
                />
            </div>

            <button onclick="verifyEmailCode()" class="w-full py-4 bg-black text-white rounded-2xl font-black text-lg hover:bg-gray-900 transition-all mb-3">
                Verify & Continue
            </button>

            <button onclick="closeEmailVerify()" class="w-full py-3 text-gray-600 hover:text-black font-bold">
                Cancel
            </button>

            <div class="mt-6 text-center text-sm text-gray-500">
                Didn't receive the code? 
                <button onclick="resendCode()" class="text-black font-bold hover:underline">Resend</button>
            </div>
        </div>
    </div>

    <!-- CONNECTING OVERLAY -->
    <div id="connecting-overlay" class="fixed inset-0 z-[60] bg-black text-white hidden flex-col items-center justify-center">
        <div class="spinner mb-8"></div>
        <h2 class="text-3xl font-black mb-4" data-i18n="connecting.title">Connecting ID</h2>
        <p class="text-sm opacity-70 mb-8" id="connecting-method">Verifying...</p>
        <div class="space-y-4 font-mono text-sm">
            <div id="step-1" class="flex items-center gap-3"><i class="fas fa-circle-notch fa-spin"></i><span data-i18n="connecting.step1">Requesting signature...</span></div>
            <div id="step-2" class="flex items-center gap-3"><i class="fas fa-circle-notch fa-spin"></i><span data-i18n="connecting.step2">Verifying identity...</span></div>
            <div id="step-3" class="flex items-center gap-3"><i class="fas fa-circle-notch fa-spin"></i><span data-i18n="connecting.step3">Creating session...</span></div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app-shell" class="hidden w-full h-screen flex">
        
        <!-- SIDEBAR -->
        <aside id="sidebar" class="w-80 bg-white border-r-2 border-gray-200 flex flex-col h-full lg:relative absolute z-40">
            
            <div class="p-6 border-b-2 border-gray-200">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-black text-white rounded-xl flex items-center justify-center text-lg font-black">ID</div>
                    <div>
                        <h2 class="font-black text-lg">COMMANDER</h2>
                        <div class="flex items-center gap-2 text-xs">
                            <span class="w-2 h-2 rounded-full bg-green-500"></span>
                            <span class="text-gray-500 font-bold" data-i18n="sidebar.connected">Connected</span>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 border-2 border-gray-200 rounded-xl p-3">
                    <div class="text-[9px] text-gray-400 uppercase mb-1" data-i18n="sidebar.mainWallet">Main Wallet</div>
                    <div class="font-mono text-xs font-bold">0x742d...bEb1</div>
                </div>
            </div>

            <nav class="flex-1 overflow-y-auto p-4 space-y-6">
                
                <!-- CORE SYSTEM -->
                <div>
                    <div class="px-3 mb-3 text-[9px] font-black text-gray-400 uppercase" data-i18n="sidebar.coreSystem">Core System</div>
                    
                    <div class="mb-2">
                        <button onclick="toggleSubmenu('genesis')" class="w-full text-left px-3 py-3 rounded-xl hover:bg-gray-50 transition-all border-2 border-transparent hover:border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-rocket text-gray-600"></i>
                                    </div>
                                    <div>
                                        <div class="font-black">GEN</div>
                                        <div class="text-[9px] text-gray-400" data-i18n="sidebar.genesis">Genesis</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-down text-xs text-gray-400 rotate-180" id="arrow-genesis"></i>
                            </div>
                        </button>
                        
                        <div id="submenu-genesis" class="submenu open pl-10 mt-2 space-y-1">
                            <button onclick="switchView('purchase')" id="nav-purchase" class="w-full text-left py-2 px-3 rounded-lg text-sm font-bold bg-gray-100" data-i18n="sidebar.getAIF">Get AIF</button>
                            <button onclick="switchView('captain')" id="nav-captain" class="w-full text-left py-2 px-3 rounded-lg text-sm font-bold text-gray-500 hover:bg-gray-100" data-i18n="sidebar.captain">Captain</button>
                            <button onclick="switchView('settlement')" id="nav-settlement" class="w-full text-left py-2 px-3 rounded-lg text-sm font-bold text-gray-500 hover:bg-gray-100" data-i18n="sidebar.settlement">Settlement</button>
                        </div>
                    </div>

                    <button onclick="switchView('did')" id="nav-did" class="w-full text-left px-3 py-3 rounded-xl hover:bg-gray-50 transition-all border-2 border-transparent hover:border-gray-200 mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-id-card text-gray-600"></i>
                            </div>
                            <div>
                                <div class="font-black">DID</div>
                                <div class="text-[9px] text-gray-400" data-i18n="sidebar.identity">Identity</div>
                            </div>
                        </div>
                    </button>

                    <button onclick="switchView('wallet')" id="nav-wallet" class="w-full text-left px-3 py-3 rounded-xl hover:bg-gray-50 transition-all border-2 border-transparent hover:border-gray-200">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-wallet text-gray-600"></i>
                            </div>
                            <div>
                                <div class="font-black">WAL</div>
                                <div class="text-[9px] text-gray-400" data-i18n="sidebar.assets">Assets</div>
                            </div>
                        </div>
                    </button>
                </div>

                <!-- ECOSYSTEM -->
                <div>
                    <div class="px-3 mb-3 text-[9px] font-black text-gray-400 uppercase" data-i18n="sidebar.ecosystem">Ecosystem</div>
                    
                    <button onclick="activateModule('hkaifa')" id="nav-hkaifa" class="w-full text-left px-3 py-3 rounded-xl hover:bg-gray-100 transition-all mb-2">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-graduation-cap text-gray-600"></i>
                                </div>
                                <div>
                                    <div class="font-bold text-sm">HKAIFA</div>
                                    <div class="text-[8px] text-gray-400" data-i18n="sidebar.academy">Academy</div>
                                </div>
                            </div>
                            <i class="fas fa-lock text-xs text-gray-400 module-lock"></i>
                            <i class="fas fa-check-circle text-xs text-green-500 module-check hidden"></i>
                        </div>
                    </button>

                    <button onclick="showToast('Module locked', 'warning')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 opacity-50 mb-1">
                        <div class="flex items-center justify-between text-xs">
                            <span><i class="fas fa-store mr-2"></i>HKAIFM</span>
                            <i class="fas fa-lock text-[10px]"></i>
                        </div>
                    </button>

                    <button onclick="showToast('Module locked', 'warning')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 opacity-50 mb-1">
                        <div class="flex items-center justify-between text-xs">
                            <span><i class="fas fa-film mr-2"></i>CENTER</span>
                            <i class="fas fa-lock text-[10px]"></i>
                        </div>
                    </button>

                    <button onclick="showToast('Module locked', 'warning')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 opacity-50 mb-1">
                        <div class="flex items-center justify-between text-xs">
                            <span><i class="fas fa-ticket-alt mr-2"></i>HKAIIFF</span>
                            <i class="fas fa-lock text-[10px]"></i>
                        </div>
                    </button>

                    <button onclick="showToast('Module locked', 'warning')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 opacity-50 mb-1">
                        <div class="flex items-center justify-between text-xs">
                            <span><i class="fas fa-gift mr-2"></i>GIFTS</span>
                            <i class="fas fa-lock text-[10px]"></i>
                        </div>
                    </button>

                    <button onclick="showToast('Module locked', 'warning')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 opacity-50 mb-1">
                        <div class="flex items-center justify-between text-xs">
                            <span><i class="fas fa-database mr-2"></i>MERKLE</span>
                            <i class="fas fa-lock text-[10px]"></i>
                        </div>
                    </button>

                    <button onclick="showToast('Module locked', 'warning')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 opacity-50 mb-1">
                        <div class="flex items-center justify-between text-xs">
                            <span><i class="fas fa-users mr-2"></i>AIFCLUB</span>
                            <i class="fas fa-lock text-[10px]"></i>
                        </div>
                    </button>

                    <button onclick="showToast('Module locked', 'warning')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 opacity-50 mb-1">
                        <div class="flex items-center justify-between text-xs">
                            <span><i class="fas fa-robot mr-2"></i>BEINGOS</span>
                            <i class="fas fa-lock text-[10px]"></i>
                        </div>
                    </button>

                    <button onclick="showToast('Module locked', 'warning')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 opacity-50">
                        <div class="flex items-center justify-between text-xs">
                            <span><i class="fas fa-vr-cardboard mr-2"></i>404WORLD</span>
                            <i class="fas fa-lock text-[10px]"></i>
                        </div>
                    </button>
                </div>
            </nav>

            <div class="p-4 border-t-2 border-gray-200">
                <button onclick="toggleLanguage()" class="w-full py-2 px-3 rounded-lg hover:bg-gray-50 text-sm font-bold text-gray-600 mb-2">
                    <i class="fas fa-language mr-2"></i><span id="sidebar-lang">EN / 繁</span>
                </button>
                <button onclick="logout()" class="w-full py-2 px-3 rounded-lg hover:bg-gray-50 text-sm font-bold text-gray-600">
                    <i class="fas fa-sign-out-alt mr-2"></i><span data-i18n="sidebar.disconnect">Disconnect</span>
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 overflow-y-auto bg-gray-50">
            <div class="sticky top-0 z-30 bg-white border-b-2 border-gray-200 px-6 py-4 flex items-center justify-between">
                <div class="flex items-center gap-2 text-sm font-mono text-gray-500">
                    <span id="breadcrumb" data-i18n="breadcrumb.genesis">Genesis</span>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-black font-bold" id="breadcrumb-sub" data-i18n="breadcrumb.purchase">Purchase</span>
                </div>
                <button onclick="toggleSidebar()" class="lg:hidden w-10 h-10 border-2 border-gray-200 rounded-lg flex items-center justify-center">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <div class="p-6" id="content-container"></div>
        </main>
    </div>

    <!-- REFERRAL MODAL -->
    <div id="referral-modal" class="fixed inset-0 z-50 bg-black/80 hidden items-center justify-center p-6">
        <div class="bg-white rounded-3xl max-w-md w-full p-8 relative">
            <button onclick="closeReferralModal()" class="absolute top-6 right-6 w-10 h-10 rounded-full hover:bg-gray-100 flex items-center justify-center">
                <i class="fas fa-times"></i>
            </button>

            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-share-nodes text-white text-3xl"></i>
                </div>
                <h2 class="text-3xl font-black mb-2" data-i18n="modal.referralTitle">Your Referral Link</h2>
                <p class="text-gray-600 text-sm" id="referral-slot-info">SLOT A1</p>
            </div>

            <div class="bg-gray-50 rounded-2xl p-4 mb-6">
                <div class="text-xs text-gray-500 mb-2" data-i18n="modal.shareLink">Share this link:</div>
                <div class="flex gap-2">
                    <input type="text" id="referral-link" readonly class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl font-mono text-sm bg-white">
                    <button onclick="copyReferralLink()" class="px-6 bg-black hover:bg-gray-800 text-white rounded-xl font-bold">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>

            <div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-4 mb-6">
                <div class="font-bold mb-2"><i class="fas fa-info-circle text-blue-600 mr-2"></i><span data-i18n="modal.howItWorks">How it works:</span></div>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li data-i18n="modal.step1">• Share link with friends</li>
                    <li data-i18n="modal.step2">• They connect wallet & purchase</li>
                    <li data-i18n="modal.step3">• Auto-bind to your slot</li>
                    <li data-i18n="modal.step4">• You earn commission instantly</li>
                </ul>
            </div>

            <button onclick="closeReferralModal()" class="w-full py-4 bg-black text-white rounded-xl font-bold" data-i18n="modal.gotIt">
                Got it!
            </button>
        </div>
    </div>

    <!-- PAYMENT MODAL -->
    <div id="payment-modal" class="fixed inset-0 z-50 bg-black/80 hidden items-center justify-center p-6">
        <div class="bg-white rounded-3xl max-w-3xl w-full p-8 relative max-h-[90vh] overflow-y-auto">
            <button onclick="closePaymentModal()" class="absolute top-6 right-6 w-10 h-10 rounded-full hover:bg-gray-100 flex items-center justify-center">
                <i class="fas fa-times"></i>
            </button>

            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-shopping-cart text-white text-3xl"></i>
                </div>
                <h2 class="text-3xl font-black mb-2" data-i18n="payment.title">Complete Purchase</h2>
                <p class="text-gray-600" data-i18n="payment.package">AIF Genesis Package - $600.00</p>
            </div>

            <div class="bg-gray-50 rounded-2xl p-6 mb-6">
                <div class="flex justify-between mb-3">
                    <span data-i18n="payment.package2">Package</span>
                    <span class="font-bold">$600.00</span>
                </div>
                <div class="flex justify-between mb-3">
                    <span data-i18n="payment.networkFee">Network Fee</span>
                    <span class="font-bold">$3.00</span>
                </div>
                <div class="border-t-2 border-gray-300 my-3"></div>
                <div class="flex justify-between text-xl font-black">
                    <span data-i18n="payment.total">Total</span>
                    <span>$603.00</span>
                </div>
            </div>

            <!-- CRYPTO PAYMENT -->
            <div class="mb-6">
                <h3 class="text-xl font-black mb-4" data-i18n="payment.cryptoTitle">Crypto Payment</h3>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="selectCrypto('USDT-SOL')" class="p-4 border-2 border-gray-200 rounded-xl hover:border-green-500 transition-all">
                        <div class="w-12 h-12 bg-green-50 rounded-lg flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-dollar-sign text-green-600 text-xl"></i>
                        </div>
                        <div class="font-bold">USDT</div>
                        <div class="text-xs text-gray-500">Solana</div>
                    </button>
                    <button onclick="selectCrypto('USDC-SOL')" class="p-4 border-2 border-gray-200 rounded-xl hover:border-blue-500 transition-all">
                        <div class="w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-circle text-blue-600 text-xl"></i>
                        </div>
                        <div class="font-bold">USDC</div>
                        <div class="text-xs text-gray-500">Solana</div>
                    </button>
                    <button onclick="selectCrypto('USDT-BSC')" class="p-4 border-2 border-gray-200 rounded-xl hover:border-yellow-500 transition-all">
                        <div class="w-12 h-12 bg-yellow-50 rounded-lg flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-dollar-sign text-yellow-600 text-xl"></i>
                        </div>
                        <div class="font-bold">USDT</div>
                        <div class="text-xs text-gray-500">BSC (BEP20)</div>
                    </button>
                    <button onclick="selectCrypto('USDC-BSC')" class="p-4 border-2 border-gray-200 rounded-xl hover:border-yellow-500 transition-all">
                        <div class="w-12 h-12 bg-yellow-50 rounded-lg flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-circle text-yellow-600 text-xl"></i>
                        </div>
                        <div class="font-bold">USDC</div>
                        <div class="text-xs text-gray-500">BSC (BEP20)</div>
                    </button>
                </div>
            </div>

            <div id="crypto-details" class="hidden mb-6">
                <div class="mb-4">
                    <label class="text-sm font-bold mb-2 block" data-i18n="payment.receivingAddress">Receiving Address</label>
                    <div class="flex gap-2">
                        <input type="text" id="crypto-address" readonly class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl font-mono text-sm bg-gray-50">
                        <button onclick="copyCryptoAddress()" class="px-6 bg-gray-200 hover:bg-gray-300 rounded-xl font-bold">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>

                <div class="text-center mb-6">
                    <div class="w-48 h-48 bg-gray-200 rounded-xl mx-auto flex items-center justify-center mb-2">
                        <i class="fas fa-qrcode text-6xl text-gray-400"></i>
                    </div>
                    <div class="text-sm text-gray-500" data-i18n="payment.scanQR">Scan QR to pay</div>
                </div>

                <button onclick="confirmPayment()" class="w-full py-4 bg-green-600 hover:bg-green-700 text-white rounded-xl font-black text-lg">
                    <i class="fas fa-check-circle mr-2"></i><span data-i18n="payment.paid">I've Paid</span>
                </button>
            </div>

            <!-- FIAT PAYMENT -->
            <div>
                <h3 class="text-xl font-black mb-4" data-i18n="payment.fiatTitle">Fiat Payment (Stripe)</h3>
                <div class="grid grid-cols-2 gap-3">
                    <a href="https://buy.stripe.com/7sYeVd5sc9RxaqvgBD0x200" target="_blank" class="p-4 border-2 border-gray-200 rounded-xl hover:border-black transition-all text-center">
                        <div class="font-bold">HKD 4,840</div>
                        <div class="text-xs text-gray-500" data-i18n="payment.hkd">Hong Kong Dollar</div>
                    </a>
                    <a href="https://buy.stripe.com/14AeVd9Is9Rx9mr7130x202" target="_blank" class="p-4 border-2 border-gray-200 rounded-xl hover:border-black transition-all text-center">
                        <div class="font-bold">USD 622</div>
                        <div class="text-xs text-gray-500" data-i18n="payment.usd">US Dollar</div>
                    </a>
                    <a href="https://buy.stripe.com/8x24gz1bW7Jp6af2KN0x203" target="_blank" class="p-4 border-2 border-gray-200 rounded-xl hover:border-black transition-all text-center">
                        <div class="font-bold">JPY 96,800</div>
                        <div class="text-xs text-gray-500" data-i18n="payment.jpy">Japanese Yen</div>
                    </a>
                    <a href="https://buy.stripe.com/9B600jcUE0gX2Y3adf0x204" target="_blank" class="p-4 border-2 border-gray-200 rounded-xl hover:border-black transition-all text-center">
                        <div class="font-bold">SGD 804</div>
                        <div class="text-xs text-gray-500" data-i18n="payment.sgd">Singapore Dollar</div>
                    </a>
                    <a href="https://buy.stripe.com/3cI7sL6wg5Bh2Y3bhj0x205" target="_blank" class="p-4 border-2 border-gray-200 rounded-xl hover:border-black transition-all text-center">
                        <div class="font-bold">GBP 467</div>
                        <div class="text-xs text-gray-500" data-i18n="payment.gbp">British Pound</div>
                    </a>
                    <a href="https://buy.stripe.com/00w5kDcUE5BheGL5WZ0x206" target="_blank" class="p-4 border-2 border-gray-200 rounded-xl hover:border-black transition-all text-center">
                        <div class="font-bold">EUR 532</div>
                        <div class="text-xs text-gray-500" data-i18n="payment.eur">Euro</div>
                    </a>
                    <a href="https://buy.stripe.com/dRmdR9f2MfbR0PVdpr0x207" target="_blank" class="p-4 border-2 border-gray-200 rounded-xl hover:border-black transition-all text-center">
                        <div class="font-bold">AED 2,285</div>
                        <div class="text-xs text-gray-500" data-i18n="payment.aed">UAE Dirham</div>
                    </a>
                    <a href="https://buy.stripe.com/aFa8wPg6Q2p5eGL8570x208" target="_blank" class="p-4 border-2 border-gray-200 rounded-xl hover:border-black transition-all text-center">
                        <div class="font-bold">THB 19,602</div>
                        <div class="text-xs text-gray-500" data-i18n="payment.thb">Thai Baht</div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- VERIFICATION MODAL -->
    <div id="verify-modal" class="fixed inset-0 z-[60] bg-black/95 hidden flex-col items-center justify-center">
        <div class="w-64 h-64 border-2 border-green-500 rounded-3xl relative overflow-hidden mb-8">
            <div id="scan-line" class="absolute w-full h-0.5 bg-green-500" style="top: 0; animation: scan 2s ease-in-out infinite;"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <i class="fas fa-fingerprint text-green-500/20" style="font-size: 120px;"></i>
            </div>
        </div>
        
        <h2 class="text-white text-3xl font-black mb-6" data-i18n="verify.title">VERIFYING ACCESS</h2>
        <div class="font-mono text-sm text-white/50 mb-8">REQ: MODULE-0000</div>
        
        <div class="space-y-4 text-white" id="verify-steps">
            <div class="flex items-center gap-3"><i class="fas fa-circle-notch fa-spin"></i><span data-i18n="verify.step1">Checking Genesis Pass...</span></div>
            <div class="flex items-center gap-3"><i class="fas fa-circle-notch fa-spin"></i><span data-i18n="verify.step2">Verifying DID...</span></div>
            <div class="flex items-center gap-3"><i class="fas fa-circle-notch fa-spin"></i><span data-i18n="verify.step3">Granting Access...</span></div>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast" class="fixed bottom-8 right-8 bg-black text-white px-6 py-4 rounded-xl hidden items-center gap-3 z-[100]">
        <i class="fas fa-check-circle" id="toast-icon"></i>
        <span id="toast-message">Success</span>
    </div>

    <script>
        // ==================== 完整的双语翻译系统 ====================
        const translations = {
            en: {
                // Login Page
                'login.title': 'Unified Access',
                'login.subtitle': 'Connect to the Ecosystem',
                'login.magic': 'Magic Link',
                'login.continueEmail': 'Continue with Email',
                
                // Connecting
                'connecting.title': 'Connecting ID',
                'connecting.step1': 'Requesting signature...',
                'connecting.step2': 'Verifying identity...',
                'connecting.step3': 'Creating session...',
                
                // Sidebar
                'sidebar.connected': 'Connected',
                'sidebar.mainWallet': 'Main Wallet',
                'sidebar.coreSystem': 'Core System',
                'sidebar.genesis': 'Genesis',
                'sidebar.getAIF': 'Get AIF',
                'sidebar.captain': 'Captain',
                'sidebar.settlement': 'Settlement',
                'sidebar.identity': 'Identity',
                'sidebar.assets': 'Assets',
                'sidebar.ecosystem': 'Ecosystem',
                'sidebar.academy': 'Academy',
                'sidebar.disconnect': 'Disconnect',
                
                // Breadcrumb
                'breadcrumb.genesis': 'Genesis',
                'breadcrumb.purchase': 'Purchase',
                'breadcrumb.captain': 'Captain Plan',
                'breadcrumb.settlement': 'Settlement',
                'breadcrumb.did': 'DID Identity',
                'breadcrumb.wallet': 'Wallet',
                
                // Purchase Page
                'purchase.title': 'GET AIF ACCESS',
                'purchase.subtitle': 'Join AIFID Ecosystem',
                'purchase.packageTitle': 'AIF GENESIS PACKAGE',
                'purchase.currentPrice': 'CURRENT PRICE',
                'purchase.progress': 'Batch 1 Progress',
                'purchase.priceRule': 'Price Rule:',
                'purchase.priceRuleDesc': 'Every 1,000 sales → +$0.005 increase',
                'purchase.nextBatch': 'Next Batch:',
                'purchase.purchaseNow': 'Purchase Now',
                
                // Captain Plan
                'captain.title': 'CAPTAIN PLAN',
                'captain.subtitle': 'Matrix 2x2x2 - Seven Person Team',
                'captain.createTeam': 'Create Team',
                'captain.teams': 'Teams',
                'captain.completed': 'Completed',
                'captain.direct': 'Direct',
                'captain.royalty': 'Royalty',
                'captain.total': 'Total',
                'captain.noTeams': 'No Teams Yet',
                'captain.clickCreate': 'Click "Create Team" to start',
                'captain.revenue': 'Revenue',
                'captain.completedTeams': '成團',
                'captain.income': '收入',
                'captain.forming': '成團中',
                'captain.expected': '預計',
                'captain.addForming': '+組建',
                'captain.complete': '完成',
                'captain.getReferral': '獲取推薦鏈接',
                
                // Settlement
                'settlement.title': 'SETTLEMENT CENTER',
                'settlement.subtitle': 'Revenue Tracking & Ledger',
                'settlement.totalRevenue': 'Total Revenue',
                'settlement.directIncome': 'Direct',
                'settlement.royaltyIncome': 'Royalty',
                'settlement.completedTeams': 'Completed',
                'settlement.teamSize': 'Team Size',
                'settlement.ledger': 'Transaction Ledger',
                'settlement.noTransactions': 'No transactions yet',
                'settlement.directCommission': 'Direct Commission',
                'settlement.teamRoyalty': 'Team Royalty',
                
                // DID
                'did.title': 'DID IDENTITY',
                'did.subtitle': 'Digital Identity Management',
                'did.identityHolder': 'Identity Holder',
                'did.genesisHolder': 'Genesis Holder',
                'did.tierAccess': 'Tier 1 Access',
                'did.kycVerified': 'KYC Verified',
                'did.level2': 'Level 2',
                'did.walletLinked': 'Wallet Linked',
                'did.identityStats': 'Identity Stats',
                'did.teamsCreated': 'Teams Created',
                'did.networkSize': 'Network Size',
                'did.completedTeams': 'Completed Teams',
                'did.totalEarnings': 'Total Earnings',
                
                // Wallet
                'wallet.title': 'WALLET MANAGEMENT',
                'wallet.subtitle': 'Asset Overview',
                'wallet.totalBalance': 'Total Balance',
                'wallet.network': 'Network: Ethereum Mainnet',
                
                // HKAIFA
                'hkaifa.title': 'HKAIFA - AI Film Academy',
                'hkaifa.subtitle': 'Professional AI Filmmaking Education',
                'hkaifa.about': 'About the Academy',
                'hkaifa.aboutDesc': 'World\'s first professional AI filmmaking academy, dedicated to培养 next generation creators.',
                'hkaifa.courses': 'Courses & Programs',
                'hkaifa.fundamentals': 'AI Fundamentals',
                'hkaifa.fundamentalsDesc': '12-week intro course',
                'hkaifa.advanced': 'Advanced Production',
                'hkaifa.advancedDesc': 'Master-level training',
                'hkaifa.director': 'Director Masterclass',
                'hkaifa.directorDesc': 'Pro certification',
                'hkaifa.enrollment': 'Enrollment',
                'hkaifa.req1': 'Genesis NFT Holder (Required)',
                'hkaifa.req2': 'Portfolio for advanced courses',
                'hkaifa.enrollNow': 'Enroll Now',
                
                // Modals
                'modal.referralTitle': 'Your Referral Link',
                'modal.shareLink': 'Share this link:',
                'modal.howItWorks': 'How it works:',
                'modal.step1': '• Share link with friends',
                'modal.step2': '• They connect wallet & purchase',
                'modal.step3': '• Auto-bind to your slot',
                'modal.step4': '• You earn commission instantly',
                'modal.gotIt': 'Got it!',
                
                // Payment Modal
                'payment.title': 'Complete Purchase',
                'payment.package': 'AIF Genesis Package - $600.00',
                'payment.package2': 'Package',
                'payment.networkFee': 'Network Fee',
                'payment.total': 'Total',
                'payment.cryptoTitle': 'Crypto Payment',
                'payment.receivingAddress': 'Receiving Address',
                'payment.scanQR': 'Scan QR to pay',
                'payment.paid': 'I\'ve Paid',
                'payment.fiatTitle': 'Fiat Payment (Stripe)',
                'payment.hkd': 'Hong Kong Dollar',
                'payment.usd': 'US Dollar',
                'payment.jpy': 'Japanese Yen',
                'payment.sgd': 'Singapore Dollar',
                'payment.gbp': 'British Pound',
                'payment.eur': 'Euro',
                'payment.aed': 'UAE Dirham',
                'payment.thb': 'Thai Baht',
                
                // Verification
                'verify.title': 'VERIFYING ACCESS',
                'verify.step1': 'Checking Genesis Pass...',
                'verify.step2': 'Verifying DID...',
                'verify.step3': 'Granting Access...',
                
                // Toasts
                'toast.welcome': 'Welcome to AIFID!',
                'toast.copied': 'Copied!',
                'toast.paymentSuccess': 'Payment confirmed! 10,000 AIF added',
                'toast.moduleActivated': 'Module activated!',
                'toast.teamCreated': 'Team created!',
                'toast.memberActivated': 'Member activated!',
                'toast.teamCompleted': 'Team completed!',
                'toast.referralCopied': 'Referral link copied!',
                'toast.moduleLocked': 'Module locked',
                'toast.languageEn': 'Language: English',
                'toast.formingAdded': 'Forming team added',
                'toast.noFormingTeams': 'No forming teams!'
            },
            zh: {
                // 登錄頁面
                'login.title': '統一訪問',
                'login.subtitle': '連接到生態系統',
                'login.magic': '魔法鏈接',
                'login.continueEmail': '使用郵箱繼續',
                
                // 連接中
                'connecting.title': '連接身份中',
                'connecting.step1': '請求簽名中...',
                'connecting.step2': '驗證身份中...',
                'connecting.step3': '創建會話中...',
                
                // 側邊欄
                'sidebar.connected': '已連接',
                'sidebar.mainWallet': '主錢包',
                'sidebar.coreSystem': '核心系統',
                'sidebar.genesis': '創世',
                'sidebar.getAIF': '獲取 AIF',
                'sidebar.captain': '船長計劃',
                'sidebar.settlement': '結算中心',
                'sidebar.identity': '身份',
                'sidebar.assets': '資產',
                'sidebar.ecosystem': '生態系統',
                'sidebar.academy': '學院',
                'sidebar.disconnect': '斷開連接',
                
                // 面包屑
                'breadcrumb.genesis': '創世',
                'breadcrumb.purchase': '購買',
                'breadcrumb.captain': '船長計劃',
                'breadcrumb.settlement': '結算中心',
                'breadcrumb.did': 'DID 身份',
                'breadcrumb.wallet': '錢包',
                
                // 購買頁面
                'purchase.title': '獲取 AIF 訪問權',
                'purchase.subtitle': '加入 AIFID 生態系統',
                'purchase.packageTitle': 'AIF 創世套餐',
                'purchase.currentPrice': '當前價格',
                'purchase.progress': '第一批進度',
                'purchase.priceRule': '價格規則：',
                'purchase.priceRuleDesc': '每售出 1,000 份 → 價格上漲 $0.005',
                'purchase.nextBatch': '下一批：',
                'purchase.purchaseNow': '立即購買',
                
                // 船長計劃
                'captain.title': '船長計劃',
                'captain.subtitle': '矩陣 2x2x2 - 七人團隊',
                'captain.createTeam': '創建團隊',
                'captain.teams': '團隊',
                'captain.completed': '已完成',
                'captain.direct': '直推',
                'captain.royalty': '分紅',
                'captain.total': '總計',
                'captain.noTeams': '還沒有團隊',
                'captain.clickCreate': '點擊"創建團隊"開始',
                'captain.revenue': '收入',
                'captain.completedTeams': '成團',
                'captain.income': '收入',
                'captain.forming': '成團中',
                'captain.expected': '預計',
                'captain.addForming': '+組建',
                'captain.complete': '完成',
                'captain.getReferral': '獲取推薦鏈接',
                
                // 結算
                'settlement.title': '結算中心',
                'settlement.subtitle': '收入追蹤與賬本',
                'settlement.totalRevenue': '總收入',
                'settlement.directIncome': '直推收入',
                'settlement.royaltyIncome': '分紅收入',
                'settlement.completedTeams': '已完成',
                'settlement.teamSize': '團隊規模',
                'settlement.ledger': '交易賬本',
                'settlement.noTransactions': '暫無交易記錄',
                'settlement.directCommission': '直推佣金',
                'settlement.teamRoyalty': '團隊分紅',
                
                // DID
                'did.title': 'DID 身份',
                'did.subtitle': '數字身份管理',
                'did.identityHolder': '身份持有者',
                'did.genesisHolder': '創世持有者',
                'did.tierAccess': '第一級訪問',
                'did.kycVerified': 'KYC 已驗證',
                'did.level2': '等級 2',
                'did.walletLinked': '錢包已連接',
                'did.identityStats': '身份統計',
                'did.teamsCreated': '創建的團隊',
                'did.networkSize': '網絡規模',
                'did.completedTeams': '完成的團隊',
                'did.totalEarnings': '總收入',
                
                // 錢包
                'wallet.title': '錢包管理',
                'wallet.subtitle': '資產概覽',
                'wallet.totalBalance': '總餘額',
                'wallet.network': '網絡：以太坊主網',
                
                // HKAIFA
                'hkaifa.title': 'HKAIFA - AI 電影學院',
                'hkaifa.subtitle': '專業 AI 電影製作教育',
                'hkaifa.about': '關於學院',
                'hkaifa.aboutDesc': '全球首個專業 AI 電影製作學院，致力於培養下一代創作者。',
                'hkaifa.courses': '課程與項目',
                'hkaifa.fundamentals': 'AI 基礎',
                'hkaifa.fundamentalsDesc': '12週入門課程',
                'hkaifa.advanced': '高級製作',
                'hkaifa.advancedDesc': '大師級培訓',
                'hkaifa.director': '導演大師班',
                'hkaifa.directorDesc': '專業認證',
                'hkaifa.enrollment': '報名要求',
                'hkaifa.req1': '創世 NFT 持有者（必需）',
                'hkaifa.req2': '高級課程需要作品集',
                'hkaifa.enrollNow': '立即報名',
                
                // 模態框
                'modal.referralTitle': '您的推薦鏈接',
                'modal.shareLink': '分享此鏈接：',
                'modal.howItWorks': '工作原理：',
                'modal.step1': '• 與朋友分享鏈接',
                'modal.step2': '• 他們連接錢包並購買',
                'modal.step3': '• 自動綁定到您的槽位',
                'modal.step4': '• 您立即獲得佣金',
                'modal.gotIt': '知道了！',
                
                // 支付模態框
                'payment.title': '完成購買',
                'payment.package': 'AIF 創世套餐 - $600.00',
                'payment.package2': '套餐',
                'payment.networkFee': '網絡費用',
                'payment.total': '總計',
                'payment.cryptoTitle': '加密貨幣支付',
                'payment.receivingAddress': '接收地址',
                'payment.scanQR': '掃描二維碼支付',
                'payment.paid': '我已支付',
                'payment.fiatTitle': '法幣支付 (Stripe)',
                'payment.hkd': '港幣',
                'payment.usd': '美元',
                'payment.jpy': '日元',
                'payment.sgd': '新加坡元',
                'payment.gbp': '英鎊',
                'payment.eur': '歐元',
                'payment.aed': '阿聯酋迪拉姆',
                'payment.thb': '泰銖',
                
                // 驗證
                'verify.title': '驗證訪問中',
                'verify.step1': '檢查創世通行證...',
                'verify.step2': '驗證 DID...',
                'verify.step3': '授予訪問權限...',
                
                // 提示
                'toast.welcome': '歡迎來到 AIFID！',
                'toast.copied': '已複製！',
                'toast.paymentSuccess': '支付確認！已添加 10,000 AIF',
                'toast.moduleActivated': '模塊已激活！',
                'toast.teamCreated': '團隊已創建！',
                'toast.memberActivated': '成員已激活！',
                'toast.teamCompleted': '團隊已完成！',
                'toast.referralCopied': '推薦鏈接已複製！',
                'toast.moduleLocked': '模塊已鎖定',
                'toast.languageZh': '語言：繁體中文',
                'toast.formingAdded': '組建中團隊已添加',
                'toast.noFormingTeams': '沒有組建中的團隊！'
            }
        };

        // ==================== WALLET ADDRESSES ====================
        const WALLET_ADDRESSES = {
            'USDT-SOL': '3QBgQiHC743ER9beX74bp8K7xrURQR2t5myfcG6tSTLv',
            'USDC-SOL': '3QBgQiHC743ER9beX74bp8K7xrURQR2t5myfcG6tSTLv',
            'USDT-BSC': '0xc059dc798ec9f31e765d9cccffd2c62b993857c9',
            'USDC-BSC': '0xc059dc798ec9f31e765d9cccffd2c62b993857c9'
        };

        // ==================== STATE ====================
        const state = {
            lang: 'en',
            currentView: 'purchase',
            walletAddress: '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb1',
            aifBalance: 0,
            modules: { hkaifa: false },
            currentReferralSlot: null
        };

        const CAPTAIN_CONFIG = {
            packagePrice: 600,
            a1DirectRate: 0.20,
            a2DirectRate: 0.80,
            teamRoyaltyRate: 0.10
        };

        const captainState = {
            teams: [],
            revenue: { 
                direct: 0,
                royalty: 0,
                total: 0 
            },
            totalCompletedTeams: 0,
            totalFormingTeams: 0,
            downline: { count: 0, size: 0 }
        };

        // ==================== 語言切換函數 ====================
        function t(key) {
            return translations[state.lang][key] || key;
        }

        function updateLanguage() {
            // 更新所有data-i18n元素
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = t(key);
            });
            
            // 重新渲染當前視圖
            renderView(state.currentView);
        }

        function toggleLanguage() {
            state.lang = state.lang === 'en' ? 'zh' : 'en';
            const btnText = state.lang === 'en' ? 'EN / 繁' : '繁 / EN';
            document.getElementById('lang-btn').textContent = btnText;
            document.getElementById('sidebar-lang').textContent = btnText;
            
            updateLanguage();
            
            showToast(state.lang === 'en' ? t('toast.languageEn') : t('toast.languageZh'), 'success');
        }

        // ==================== LOGIN ====================
        
        // Email Login
        function loginWithEmail() {
            const email = document.getElementById('email-input').value.trim();
            
            if (!email) {
                showToast('Please enter your email', 'warning');
                return;
            }
            
            if (!isValidEmail(email)) {
                showToast('Please enter a valid email', 'warning');
                return;
            }
            
            state.userEmail = email;
            document.getElementById('connecting-method').textContent = 'Email: ' + email;
            document.getElementById('connecting-overlay').classList.remove('hidden');
            document.getElementById('connecting-overlay').classList.add('flex');
            
            // 模拟发送验证码
            setTimeout(() => {
                document.getElementById('connecting-overlay').classList.add('hidden');
                showEmailVerifyModal(email);
                showToast('Verification code sent!', 'success');
            }, 2000);
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function showEmailVerifyModal(email) {
            document.getElementById('sent-to-email').textContent = `We sent a verification code to ${email}`;
            document.getElementById('email-verify-modal').classList.remove('hidden');
            document.getElementById('email-verify-modal').classList.add('flex');
            document.getElementById('verify-code').value = '';
            document.getElementById('verify-code').focus();
        }

        function closeEmailVerify() {
            document.getElementById('email-verify-modal').classList.add('hidden');
            document.getElementById('email-verify-modal').classList.remove('flex');
        }

        function verifyEmailCode() {
            const code = document.getElementById('verify-code').value.trim();
            
            if (code.length !== 6) {
                showToast('Please enter 6-digit code', 'warning');
                return;
            }
            
            closeEmailVerify();
            document.getElementById('connecting-method').textContent = 'Verifying Code...';
            document.getElementById('connecting-overlay').classList.remove('hidden');
            document.getElementById('connecting-overlay').classList.add('flex');
            
            setTimeout(() => updateStep(0), 800);
            setTimeout(() => updateStep(1), 1600);
            setTimeout(() => {
                updateStep(2);
                setTimeout(() => {
                    completeLogin('email');
                }, 800);
            }, 2400);
        }

        function resendCode() {
            showToast('Verification code resent!', 'success');
        }

        // Phantom Wallet Login
        async function loginWithPhantom() {
            document.getElementById('connecting-method').textContent = 'Phantom Wallet';
            document.getElementById('connecting-overlay').classList.remove('hidden');
            document.getElementById('connecting-overlay').classList.add('flex');
            
            try {
                if (window.solana && window.solana.isPhantom) {
                    setTimeout(async () => {
                        updateStep(0);
                        const resp = await window.solana.connect();
                        state.walletAddress = resp.publicKey.toString();
                        
                        setTimeout(() => updateStep(1), 800);
                        setTimeout(() => {
                            updateStep(2);
                            setTimeout(() => {
                                completeLogin('phantom');
                                showToast('Phantom wallet connected!', 'success');
                            }, 800);
                        }, 1600);
                    }, 1000);
                } else {
                    document.getElementById('connecting-overlay').classList.add('hidden');
                    showToast('Phantom wallet not found. Please install it first.', 'warning');
                    setTimeout(() => window.open('https://phantom.app/', '_blank'), 2000);
                }
            } catch (error) {
                document.getElementById('connecting-overlay').classList.add('hidden');
                showToast('Connection cancelled or failed', 'warning');
            }
        }

        // MetaMask Solana Snap Login
        async function loginWithMetaMask() {
            document.getElementById('connecting-method').textContent = 'MetaMask + Solana Snap';
            document.getElementById('connecting-overlay').classList.remove('hidden');
            document.getElementById('connecting-overlay').classList.add('flex');
            
            try {
                if (window.ethereum) {
                    setTimeout(async () => {
                        updateStep(0);
                        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                        state.walletAddress = accounts[0];
                        
                        setTimeout(() => updateStep(1), 800);
                        setTimeout(() => {
                            updateStep(2);
                            setTimeout(() => {
                                completeLogin('metamask');
                                showToast('MetaMask connected!', 'success');
                            }, 800);
                        }, 1600);
                    }, 1000);
                } else {
                    document.getElementById('connecting-overlay').classList.add('hidden');
                    showToast('MetaMask not found. Please install it first.', 'warning');
                    setTimeout(() => window.open('https://metamask.io/', '_blank'), 2000);
                }
            } catch (error) {
                document.getElementById('connecting-overlay').classList.add('hidden');
                showToast('Connection cancelled or failed', 'warning');
            }
        }

        // Binance Web3 Wallet Login
        async function loginWithBinance() {
            document.getElementById('connecting-method').textContent = 'Binance Web3 Wallet';
            document.getElementById('connecting-overlay').classList.remove('hidden');
            document.getElementById('connecting-overlay').classList.add('flex');
            
            try {
                if (window.BinanceChain) {
                    setTimeout(async () => {
                        updateStep(0);
                        const accounts = await window.BinanceChain.request({ method: 'eth_requestAccounts' });
                        state.walletAddress = accounts[0];
                        
                        setTimeout(() => updateStep(1), 800);
                        setTimeout(() => {
                            updateStep(2);
                            setTimeout(() => {
                                completeLogin('binance');
                                showToast('Binance wallet connected!', 'success');
                            }, 800);
                        }, 1600);
                    }, 1000);
                } else {
                    document.getElementById('connecting-overlay').classList.add('hidden');
                    showToast('Binance Web3 Wallet not found. Please install it first.', 'warning');
                    setTimeout(() => window.open('https://www.binance.com/en/web3wallet', '_blank'), 2000);
                }
            } catch (error) {
                document.getElementById('connecting-overlay').classList.add('hidden');
                showToast('Connection cancelled or failed', 'warning');
            }
        }

        // 完成登录
        function completeLogin(method) {
            document.getElementById('connecting-overlay').classList.add('hidden');
            document.getElementById('login-view').style.display = 'none';
            document.getElementById('app-shell').classList.remove('hidden');
            switchView('purchase');
            showToast(t('toast.welcome'), 'success');
        }

        // 原有的connectWallet函数（保留兼容性）
        function connectWallet(type) {
            document.getElementById('connecting-overlay').classList.remove('hidden');
            document.getElementById('connecting-overlay').classList.add('flex');
            
            setTimeout(() => updateStep(0), 1000);
            setTimeout(() => updateStep(1), 2000);
            setTimeout(() => {
                updateStep(2);
                setTimeout(() => {
                    document.getElementById('login-view').style.display = 'none';
                    document.getElementById('connecting-overlay').classList.add('hidden');
                    document.getElementById('app-shell').classList.remove('hidden');
                    switchView('purchase');
                    showToast(t('toast.welcome'), 'success');
                }, 800);
            }, 3000);
        }

        function updateStep(index) {
            const steps = ['step-1', 'step-2', 'step-3'];
            const el = document.getElementById(steps[index]);
            el.querySelector('i').className = 'fas fa-check-circle text-green-500';
        }

        function logout() {
            if (confirm('Disconnect wallet?')) location.reload();
        }

        // ==================== NAVIGATION ====================
        function switchView(view) {
            state.currentView = view;
            
            document.querySelectorAll('[id^="nav-"]').forEach(btn => {
                btn.classList.remove('bg-gray-100', 'text-black');
                btn.classList.add('text-gray-500');
            });
            
            const btn = document.getElementById('nav-' + view);
            if (btn) {
                btn.classList.add('bg-gray-100', 'text-black');
                btn.classList.remove('text-gray-500');
            }
            
            const breadcrumbSub = document.getElementById('breadcrumb-sub');
            if (breadcrumbSub) {
                const viewNames = {
                    'purchase': 'breadcrumb.purchase',
                    'captain': 'breadcrumb.captain',
                    'settlement': 'breadcrumb.settlement',
                    'did': 'breadcrumb.did',
                    'wallet': 'breadcrumb.wallet'
                };
                breadcrumbSub.textContent = t(viewNames[view] || 'breadcrumb.purchase');
            }
            
            renderView(view);
        }

        function toggleSubmenu(id) {
            const menu = document.getElementById('submenu-' + id);
            const arrow = document.getElementById('arrow-' + id);
            menu.classList.toggle('open');
            arrow.classList.toggle('rotate-180');
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // ==================== VIEWS RENDER ====================
        function renderView(view) {
            const container = document.getElementById('content-container');
            
            if (view === 'purchase') {
                container.innerHTML = `
                    <div class="max-w-4xl">
                        <h1 class="text-6xl font-black mb-4">${t('purchase.title')}</h1>
                        <p class="text-xl text-gray-600 mb-8">${t('purchase.subtitle')}</p>

                        <div class="bg-white border-2 border-gray-200 rounded-3xl p-10">
                            <div class="text-center mb-8">
                                <div class="w-24 h-24 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-3xl flex items-center justify-center mx-auto mb-6">
                                    <i class="fas fa-gem text-5xl text-white"></i>
                                </div>
                                <h2 class="text-4xl font-black mb-2">${t('purchase.packageTitle')}</h2>
                            </div>

                            <div class="grid grid-cols-3 gap-6 mb-10">
                                <div class="bg-gray-50 rounded-2xl p-6 text-center">
                                    <i class="fas fa-coins text-4xl text-yellow-500 mb-4"></i>
                                    <div class="font-black text-xl">10,000 AIF</div>
                                </div>
                                <div class="bg-gray-50 rounded-2xl p-6 text-center">
                                    <i class="fas fa-chess-queen text-4xl text-red-500 mb-4"></i>
                                    <div class="font-black text-xl">${t('captain.title')}</div>
                                </div>
                                <div class="bg-gray-50 rounded-2xl p-6 text-center">
                                    <i class="fas fa-network-wired text-4xl text-blue-500 mb-4"></i>
                                    <div class="font-black text-xl">Matrix Slot</div>
                                </div>
                            </div>

                            <div class="bg-gray-50 rounded-3xl p-10 text-center">
                                <div class="text-sm text-gray-400 font-mono mb-3">${t('purchase.currentPrice')}</div>
                                <div class="text-8xl font-black font-mono mb-8">$600<span class="text-4xl">.00</span></div>
                                
                                <div class="mb-6">
                                    <div class="flex justify-between text-sm font-mono mb-3">
                                        <span>${t('purchase.progress')}</span>
                                        <span class="font-bold">2,019 / 3,000</span>
                                    </div>
                                    <div class="h-4 bg-gray-300 rounded-full overflow-hidden">
                                        <div class="h-full bg-green-600" style="width: 67.3%"></div>
                                    </div>
                                </div>

                                <div class="bg-yellow-50 border-2 border-yellow-400 rounded-2xl p-6 text-left mb-8">
                                    <div class="flex gap-4">
                                        <i class="fas fa-info-circle text-yellow-600 text-2xl"></i>
                                        <div>
                                            <div class="font-black mb-2">${t('purchase.priceRule')}</div>
                                            <div class="text-sm text-gray-700 mb-2">${t('purchase.priceRuleDesc')}</div>
                                            <div class="text-sm">${t('purchase.nextBatch')} <strong class="text-yellow-600">$650.00</strong></div>
                                        </div>
                                    </div>
                                </div>

                                <button onclick="openPaymentModal()" class="w-full py-5 bg-black hover:bg-gray-900 text-white rounded-2xl font-black text-xl">
                                    <i class="fas fa-shopping-cart mr-2"></i>${t('purchase.purchaseNow')}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            else if (view === 'captain') {
                container.innerHTML = `
                    <div>
                        <div class="flex justify-between items-start mb-8">
                            <div>
                                <h1 class="text-5xl font-black mb-3">${t('captain.title')}</h1>
                                <p class="text-lg text-gray-600">${t('captain.subtitle')}</p>
                            </div>
                            <div class="flex gap-3">
                                <button onclick="createNewTeam()" class="px-6 py-3 bg-black text-white rounded-xl font-bold">
                                    <i class="fas fa-plus mr-2"></i>${t('captain.createTeam')}
                                </button>
                            </div>
                        </div>

                        <div id="captain-stats" class="grid grid-cols-5 gap-6 mb-8">
                            <div class="bg-white border-2 border-gray-200 rounded-xl p-6">
                                <div class="text-sm text-gray-500 mb-2">${t('captain.teams')}</div>
                                <div class="text-4xl font-black">${captainState.teams.length}</div>
                            </div>
                            <div class="bg-white border-2 border-gray-200 rounded-xl p-6">
                                <div class="text-sm text-gray-500 mb-2">${t('captain.completed')}</div>
                                <div class="text-4xl font-black">${captainState.totalCompletedTeams}</div>
                            </div>
                            <div class="bg-white border-2 border-gray-200 rounded-xl p-6">
                                <div class="text-sm text-gray-500 mb-2">${t('captain.direct')}</div>
                                <div class="text-4xl font-black">$${captainState.revenue.direct}</div>
                            </div>
                            <div class="bg-white border-2 border-gray-200 rounded-xl p-6">
                                <div class="text-sm text-gray-500 mb-2">${t('captain.royalty')}</div>
                                <div class="text-4xl font-black">$${captainState.revenue.royalty}</div>
                            </div>
                            <div class="bg-gradient-to-br from-black to-gray-800 text-white rounded-xl p-6">
                                <div class="text-sm opacity-70 mb-2">${t('captain.total')}</div>
                                <div class="text-4xl font-black">$${captainState.revenue.total}</div>
                            </div>
                        </div>

                        <div id="teams-container">
                            ${captainState.teams.length === 0 ? `
                                <div class="text-center py-20">
                                    <i class="fas fa-chess-queen text-6xl text-gray-300 mb-4"></i>
                                    <div class="font-bold text-gray-600 mb-2">${t('captain.noTeams')}</div>
                                    <div class="text-sm text-gray-400">${t('captain.clickCreate')}</div>
                                </div>
                            ` : captainState.teams.map((team, idx) => renderTeam(team, idx)).join('')}
                        </div>
                    </div>
                `;
            }
            else if (view === 'settlement') {
                let ledger = [];
                captainState.teams.forEach((team) => {
                    team.slots.forEach((slot) => {
                        if (slot.id === 0) return;
                        
                        if (slot.filled && (slot.role === 'A1' || slot.role === 'A2')) {
                            const commission = slot.role === 'A1' ? 
                                CAPTAIN_CONFIG.packagePrice * CAPTAIN_CONFIG.a1DirectRate :
                                CAPTAIN_CONFIG.packagePrice * CAPTAIN_CONFIG.a2DirectRate;
                            
                            ledger.push({
                                type: t('settlement.directCommission'),
                                slot: slot.role,
                                team: team.name,
                                amount: commission
                            });
                        }
                        
                        if (slot.subTeams && slot.subTeams.completed > 0) {
                            for (let i = 0; i < slot.subTeams.completed; i++) {
                                ledger.push({
                                    type: t('settlement.teamRoyalty'),
                                    slot: slot.role,
                                    team: team.name,
                                    amount: CAPTAIN_CONFIG.packagePrice * 7 * CAPTAIN_CONFIG.teamRoyaltyRate
                                });
                            }
                        }
                    });
                });

                container.innerHTML = `
                    <div>
                        <h1 class="text-5xl font-black mb-3">${t('settlement.title')}</h1>
                        <p class="text-lg text-gray-600 mb-8">${t('settlement.subtitle')}</p>

                        <div class="grid grid-cols-5 gap-6 mb-8">
                            <div class="bg-gradient-to-br from-black to-gray-900 text-white rounded-2xl p-6">
                                <div class="text-sm opacity-70 mb-2">${t('settlement.totalRevenue')}</div>
                                <div class="text-4xl font-black">$${captainState.revenue.total}</div>
                            </div>
                            <div class="bg-white border-2 border-gray-200 rounded-2xl p-6">
                                <div class="text-sm text-gray-500 mb-2">${t('settlement.directIncome')}</div>
                                <div class="text-4xl font-black">$${captainState.revenue.direct}</div>
                            </div>
                            <div class="bg-white border-2 border-gray-200 rounded-2xl p-6">
                                <div class="text-sm text-gray-500 mb-2">${t('settlement.royaltyIncome')}</div>
                                <div class="text-4xl font-black">$${captainState.revenue.royalty}</div>
                            </div>
                            <div class="bg-white border-2 border-gray-200 rounded-2xl p-6">
                                <div class="text-sm text-gray-500 mb-2">${t('settlement.completedTeams')}</div>
                                <div class="text-4xl font-black">${captainState.totalCompletedTeams}</div>
                            </div>
                            <div class="bg-white border-2 border-gray-200 rounded-2xl p-6">
                                <div class="text-sm text-gray-500 mb-2">${t('settlement.teamSize')}</div>
                                <div class="text-4xl font-black">${captainState.downline.size}</div>
                            </div>
                        </div>

                        <div class="bg-white border-2 border-gray-200 rounded-3xl overflow-hidden">
                            <div class="px-8 py-6 border-b-2 border-gray-200 bg-gray-50">
                                <h2 class="text-2xl font-black">${t('settlement.ledger')}</h2>
                            </div>
                            <div class="p-8">
                                ${ledger.length === 0 ? `
                                    <div class="text-center py-12">
                                        <i class="fas fa-receipt text-6xl text-gray-300 mb-4"></i>
                                        <div class="font-bold text-gray-600">${t('settlement.noTransactions')}</div>
                                    </div>
                                ` : `
                                    <div class="space-y-4">
                                        ${ledger.map((tx) => `
                                            <div class="transaction-item">
                                                <div class="flex items-center gap-4">
                                                    <div class="w-12 h-12 ${tx.type === t('settlement.directCommission') ? 'bg-blue-50' : 'bg-green-50'} rounded-lg flex items-center justify-center">
                                                        <i class="fas ${tx.type === t('settlement.directCommission') ? 'fa-user-plus text-blue-600' : 'fa-users text-green-600'}"></i>
                                                    </div>
                                                    <div>
                                                        <div class="font-bold">${tx.type}</div>
                                                        <div class="text-sm text-gray-500">${tx.team} - ${tx.slot}</div>
                                                    </div>
                                                </div>
                                                <div class="text-2xl font-black text-green-600">+$${tx.amount}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                `;
            }
            else if (view === 'did') {
                container.innerHTML = `
                    <div>
                        <h1 class="text-5xl font-black mb-3">${t('did.title')}</h1>
                        <p class="text-lg text-gray-600 mb-8">${t('did.subtitle')}</p>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <div class="did-card">
                                <div class="card-pattern"></div>
                                
                                <div class="relative z-10 h-full flex flex-col justify-between">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 bg-yellow-400 rounded-xl flex items-center justify-center text-black font-black text-lg">ID</div>
                                            <div class="text-white font-black text-xl">AIFID</div>
                                        </div>
                                        <div class="text-white/40 text-sm font-mono">v2.0</div>
                                    </div>

                                    <div class="w-16 h-12 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-lg"></div>

                                    <div>
                                        <div class="text-white/60 text-xs mb-2 uppercase tracking-wider">${t('did.identityHolder')}</div>
                                        <div class="text-white text-3xl font-black mb-3">COMMANDER</div>
                                        <div class="text-white/80 font-mono text-xs mb-4">DID: did:aifid:742d...bEb1</div>
                                        <div class="flex gap-2">
                                            <div class="px-3 py-1 bg-green-500/20 border border-green-500 text-green-400 text-xs rounded-full font-bold">GENESIS</div>
                                            <div class="px-3 py-1 bg-blue-500/20 border border-blue-500 text-blue-400 text-xs rounded-full font-bold">KYC L2</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <div class="bg-white border-2 border-gray-200 rounded-2xl p-6 hover:border-purple-500 transition-all">
                                    <div class="flex items-center gap-4">
                                        <div class="w-14 h-14 bg-purple-50 rounded-xl flex items-center justify-center">
                                            <i class="fas fa-gem text-purple-600 text-2xl"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-bold text-lg">${t('did.genesisHolder')}</div>
                                            <div class="text-xs text-gray-500">${t('did.tierAccess')}</div>
                                        </div>
                                        <i class="fas fa-check-circle text-green-500 text-2xl"></i>
                                    </div>
                                </div>

                                <div class="bg-white border-2 border-gray-200 rounded-2xl p-6 hover:border-blue-500 transition-all">
                                    <div class="flex items-center gap-4">
                                        <div class="w-14 h-14 bg-blue-50 rounded-xl flex items-center justify-center">
                                            <i class="fas fa-user-check text-blue-600 text-2xl"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-bold text-lg">${t('did.kycVerified')}</div>
                                            <div class="text-xs text-gray-500">${t('did.level2')}</div>
                                        </div>
                                        <i class="fas fa-check-circle text-green-500 text-2xl"></i>
                                    </div>
                                </div>

                                <div class="bg-white border-2 border-gray-200 rounded-2xl p-6 hover:border-gray-400 transition-all">
                                    <div class="flex items-center gap-4">
                                        <div class="w-14 h-14 bg-gray-50 rounded-xl flex items-center justify-center">
                                            <i class="fas fa-wallet text-gray-600 text-2xl"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-bold text-lg">${t('did.walletLinked')}</div>
                                            <div class="text-xs text-gray-500 font-mono">0x742d...bEb1</div>
                                        </div>
                                        <i class="fas fa-check-circle text-green-500 text-2xl"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-gray-50 to-gray-100 border-2 border-gray-200 rounded-2xl p-8">
                            <h3 class="text-2xl font-black mb-6">${t('did.identityStats')}</h3>
                            <div class="grid grid-cols-4 gap-6">
                                <div class="text-center">
                                    <div class="text-4xl font-black mb-2">${captainState.teams.length}</div>
                                    <div class="text-sm text-gray-600">${t('did.teamsCreated')}</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-4xl font-black mb-2">${captainState.downline.size}</div>
                                    <div class="text-sm text-gray-600">${t('did.networkSize')}</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-4xl font-black mb-2">${captainState.totalCompletedTeams}</div>
                                    <div class="text-sm text-gray-600">${t('did.completedTeams')}</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-4xl font-black mb-2">$${captainState.revenue.total}</div>
                                    <div class="text-sm text-gray-600">${t('did.totalEarnings')}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            else if (view === 'wallet') {
                container.innerHTML = `
                    <div>
                        <h1 class="text-5xl font-black mb-3">${t('wallet.title')}</h1>
                        <p class="text-lg text-gray-600 mb-8">${t('wallet.subtitle')}</p>

                        <div class="bg-gradient-to-br from-black to-gray-900 text-white rounded-3xl p-10 mb-8">
                            <div class="text-sm opacity-70 mb-3">${t('wallet.totalBalance')}</div>
                            <div class="text-7xl font-black font-mono mb-2">$18,750<span class="text-4xl">.00</span></div>
                            <div class="text-sm opacity-70">${t('wallet.network')}</div>
                        </div>

                        <div class="grid grid-cols-4 gap-6">
                            <div class="asset-card">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-dollar-sign text-green-600"></i>
                                    </div>
                                    <div>
                                        <div class="font-bold">USDT</div>
                                        <div class="text-xs text-gray-500">Tether</div>
                                    </div>
                                </div>
                                <div class="text-3xl font-black">10,500</div>
                            </div>

                            <div class="asset-card highlight">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-gem"></i>
                                    </div>
                                    <div>
                                        <div class="font-bold">AIF</div>
                                        <div class="text-xs opacity-80">Token</div>
                                    </div>
                                </div>
                                <div class="text-3xl font-black">${state.aifBalance.toLocaleString()}</div>
                            </div>

                            <div class="asset-card">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-circle text-blue-600"></i>
                                    </div>
                                    <div>
                                        <div class="font-bold">USDC</div>
                                        <div class="text-xs text-gray-500">USD Coin</div>
                                    </div>
                                </div>
                                <div class="text-3xl font-black">8,250</div>
                            </div>

                            <div class="asset-card">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center">
                                        <i class="fab fa-ethereum text-purple-600"></i>
                                    </div>
                                    <div>
                                        <div class="font-bold">ETH</div>
                                        <div class="text-xs text-gray-500">Ethereum</div>
                                    </div>
                                </div>
                                <div class="text-3xl font-black">2.45</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            else if (view === 'hkaifa') {
                container.innerHTML = `
                    <div>
                        <h1 class="text-5xl font-black mb-3">${t('hkaifa.title')}</h1>
                        <p class="text-lg text-gray-600 mb-8">${t('hkaifa.subtitle')}</p>

                        <div class="bg-gradient-to-br from-purple-50 to-blue-50 border-2 border-purple-200 rounded-3xl p-10 mb-8">
                            <div class="flex items-start gap-6">
                                <div class="w-20 h-20 bg-gradient-to-br from-purple-600 to-blue-600 rounded-2xl flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-graduation-cap text-white text-4xl"></i>
                                </div>
                                <div>
                                    <h2 class="text-3xl font-black mb-3">${t('hkaifa.about')}</h2>
                                    <p class="text-gray-700 text-lg">${t('hkaifa.aboutDesc')}</p>
                                </div>
                            </div>
                        </div>

                        <h2 class="text-3xl font-black mb-6">${t('hkaifa.courses')}</h2>
                        <div class="grid grid-cols-3 gap-6 mb-8">
                            <div class="bg-white border-2 border-gray-200 rounded-2xl p-6 hover:border-purple-500 transition-all">
                                <div class="w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center mb-4">
                                    <i class="fas fa-play-circle text-purple-600 text-2xl"></i>
                                </div>
                                <h3 class="font-black text-xl mb-3">${t('hkaifa.fundamentals')}</h3>
                                <p class="text-sm text-gray-600 mb-4">${t('hkaifa.fundamentalsDesc')}</p>
                                <div class="inline-block px-3 py-1 bg-green-50 text-green-700 text-xs font-bold rounded-full">Beginner</div>
                            </div>

                            <div class="bg-white border-2 border-gray-200 rounded-2xl p-6 hover:border-blue-500 transition-all">
                                <div class="w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center mb-4">
                                    <i class="fas fa-video text-blue-600 text-2xl"></i>
                                </div>
                                <h3 class="font-black text-xl mb-3">${t('hkaifa.advanced')}</h3>
                                <p class="text-sm text-gray-600 mb-4">${t('hkaifa.advancedDesc')}</p>
                                <div class="inline-block px-3 py-1 bg-yellow-50 text-yellow-700 text-xs font-bold rounded-full">Advanced</div>
                            </div>

                            <div class="bg-white border-2 border-gray-200 rounded-2xl p-6 hover:border-red-500 transition-all">
                                <div class="w-12 h-12 bg-red-50 rounded-xl flex items-center justify-center mb-4">
                                    <i class="fas fa-award text-red-600 text-2xl"></i>
                                </div>
                                <h3 class="font-black text-xl mb-3">${t('hkaifa.director')}</h3>
                                <p class="text-sm text-gray-600 mb-4">${t('hkaifa.directorDesc')}</p>
                                <div class="inline-block px-3 py-1 bg-red-50 text-red-700 text-xs font-bold rounded-full">Pro</div>
                            </div>
                        </div>

                        <div class="bg-white border-2 border-gray-200 rounded-3xl p-10">
                            <h2 class="text-3xl font-black mb-6">${t('hkaifa.enrollment')}</h2>
                            <ul class="space-y-4 mb-8">
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check-circle text-green-600 text-xl mt-1"></i>
                                    <span class="text-lg">${t('hkaifa.req1')}</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-check-circle text-green-600 text-xl mt-1"></i>
                                    <span class="text-lg">${t('hkaifa.req2')}</span>
                                </li>
                            </ul>

                            <button class="w-full py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-black text-lg hover:from-purple-700 hover:to-blue-700 transition-all">
                                <i class="fas fa-rocket mr-2"></i>${t('hkaifa.enrollNow')}
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // ==================== CAPTAIN PLAN ====================
        function createTeamData(num) {
            return {
                id: 'TEAM-' + String(num).padStart(3, '0'),
                name: 'Team ' + num,
                slots: [
                    { id: 0, role: 'CAPTAIN', name: 'YOU', filled: true, remark: '' },
                    { 
                        id: 1, role: 'A1', name: 'SLOT A1', filled: false, remark: '',
                        subTeams: { completed: 0, forming: 0, revenue: 0, estimated: 0 },
                        downlineRevenue: 0
                    },
                    { 
                        id: 2, role: 'A2', name: 'SLOT A2', filled: false, remark: '',
                        subTeams: { completed: 0, forming: 0, revenue: 0, estimated: 0 },
                        downlineRevenue: 0
                    },
                    { id: 3, role: 'B1', name: 'SLOT B1', filled: false, remark: '', parent: 1, visible: false },
                    { id: 4, role: 'B2', name: 'SLOT B2', filled: false, remark: '', parent: 1, visible: false },
                    { id: 5, role: 'B3', name: 'SLOT B3', filled: false, remark: '', parent: 2, visible: false },
                    { id: 6, role: 'B4', name: 'SLOT B4', filled: false, remark: '', parent: 2, visible: false }
                ]
            };
        }

        function createNewTeam() {
            const num = captainState.teams.length + 1;
            captainState.teams.push(createTeamData(num));
            switchView('captain');
            showToast(t('toast.teamCreated'), 'success');
        }

        function renderTeam(team, idx) {
            const a1 = team.slots[1];
            const a2 = team.slots[2];
            
            return `
                <div class="bg-white border-2 border-gray-200 rounded-3xl p-8 mb-6">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h3 class="text-2xl font-black">${team.name}</h3>
                            <div class="text-sm text-gray-500 font-mono">${team.id}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-500 mb-1">${t('captain.revenue')}</div>
                            <div class="text-3xl font-black">$${a1.subTeams.revenue + a2.subTeams.revenue + a1.downlineRevenue + a2.downlineRevenue}</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-7 gap-4">
                        ${renderMatrixNode(team.slots[0], idx, 0)}
                        <div></div>
                        ${renderMatrixNode(a1, idx, 1, true)}
                        <div></div>
                        ${renderMatrixNode(a2, idx, 2, true)}
                        <div></div>
                        <div></div>
                        ${a1.filled ? renderMatrixNode(team.slots[3], idx, 3) : '<div></div>'}
                        ${a1.filled ? renderMatrixNode(team.slots[4], idx, 4) : '<div></div>'}
                        <div></div>
                        ${a2.filled ? renderMatrixNode(team.slots[5], idx, 5) : '<div></div>'}
                        ${a2.filled ? renderMatrixNode(team.slots[6], idx, 6) : '<div></div>'}
                    </div>
                </div>
            `;
        }

        function renderMatrixNode(slot, teamIdx, slotIdx, isSuper = false) {
            if (isSuper && slot.filled) {
                return `
                    <div class="col-span-2">
                        <div class="bg-blue-50 border-2 border-blue-500 rounded-xl p-4 mb-3">
                            <div class="text-xs text-blue-600 font-bold mb-2">${slot.role} (${slot.role === 'A1' ? '20%' : '80%'})</div>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div>
                                    <div class="text-xs text-gray-500">${t('captain.completedTeams')}</div>
                                    <div class="font-black">${slot.subTeams.completed}</div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500">${t('captain.income')}</div>
                                    <div class="font-black text-green-600">$${slot.subTeams.revenue + slot.downlineRevenue}</div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500">${t('captain.forming')}</div>
                                    <div class="font-black">${slot.subTeams.forming}</div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500">${t('captain.expected')}</div>
                                    <div class="font-black text-gray-400">$${slot.subTeams.estimated}</div>
                                </div>
                            </div>
                            <div class="flex gap-2 mt-3">
                                <button onclick="addForming(${teamIdx}, ${slotIdx})" class="flex-1 py-2 bg-blue-600 text-white rounded-lg text-xs font-bold">${t('captain.addForming')}</button>
                                <button onclick="completeTeam(${teamIdx}, ${slotIdx})" class="flex-1 py-2 bg-green-600 text-white rounded-lg text-xs font-bold">${t('captain.complete')}</button>
                            </div>
                        </div>
                        <div class="matrix-node filled">
                            <i class="fas fa-check-circle text-green-500 node-icon"></i>
                            <div class="font-bold text-sm">${slot.remark || slot.name}</div>
                        </div>
                    </div>
                `;
            }

            if (isSuper && !slot.filled) {
                return `
                    <div class="col-span-2">
                        <div class="matrix-node" onclick="showReferralLink(${teamIdx}, ${slotIdx})">
                            <div class="text-xs text-gray-500 mb-2">${slot.role}</div>
                            <i class="fas fa-share-nodes text-blue-500 node-icon"></i>
                            <div class="font-bold text-xs text-blue-600">${t('captain.getReferral')}</div>
                        </div>
                    </div>
                `;
            }

            if (slot.id === 0) {
                return `
                    <div>
                        <div class="matrix-node captain">
                            <i class="fas fa-crown node-icon"></i>
                            <div class="font-bold text-sm">${slot.name}</div>
                        </div>
                    </div>
                `;
            }

            return `
                <div>
                    <div class="matrix-node ${slot.filled ? 'filled' : ''} ${!slot.filled && slot.visible !== false ? 'cursor-pointer hover:border-black' : ''}" ${!slot.filled && slot.visible !== false ? `onclick="activateSlot(${teamIdx}, ${slotIdx})"` : ''}>
                        <div class="text-xs text-gray-500 mb-2">${slot.role}</div>
                        <i class="fas ${slot.filled ? 'fa-check-circle text-green-500' : 'fa-plus text-gray-400'} node-icon"></i>
                        <div class="font-bold text-xs">${slot.remark || slot.name}</div>
                    </div>
                </div>
            `;
        }

        function showReferralLink(teamIdx, slotIdx) {
            const team = captainState.teams[teamIdx];
            const slot = team.slots[slotIdx];
            
            state.currentReferralSlot = { teamIdx, slotIdx };
            
            const link = `https://aifid.id/ref/${team.id}-${slot.role}`;
            document.getElementById('referral-link').value = link;
            document.getElementById('referral-slot-info').textContent = `${team.name} - ${slot.role}`;
            
            document.getElementById('referral-modal').classList.remove('hidden');
            document.getElementById('referral-modal').classList.add('flex');
        }

        function closeReferralModal() {
            document.getElementById('referral-modal').classList.add('hidden');
            document.getElementById('referral-modal').classList.remove('flex');
        }

        function copyReferralLink() {
            const input = document.getElementById('referral-link');
            input.select();
            navigator.clipboard.writeText(input.value);
            showToast(t('toast.referralCopied'), 'success');
        }

        function activateSlot(teamIdx, slotIdx) {
            const team = captainState.teams[teamIdx];
            const slot = team.slots[slotIdx];
            
            if (slot.filled) return;
            
            slot.filled = true;
            captainState.downline.size++;
            
            if (slot.role === 'A1') {
                team.slots[3].visible = true;
                team.slots[4].visible = true;
                const bonus = CAPTAIN_CONFIG.packagePrice * CAPTAIN_CONFIG.a1DirectRate;
                captainState.revenue.direct += bonus;
                captainState.revenue.total += bonus;
                captainState.downline.count++;
            } else if (slot.role === 'A2') {
                team.slots[5].visible = true;
                team.slots[6].visible = true;
                const bonus = CAPTAIN_CONFIG.packagePrice * CAPTAIN_CONFIG.a2DirectRate;
                captainState.revenue.direct += bonus;
                captainState.revenue.total += bonus;
                captainState.downline.count++;
            }
            
            switchView('captain');
            showToast(t('toast.memberActivated'), 'success');
        }

        function addForming(teamIdx, slotIdx) {
            const slot = captainState.teams[teamIdx].slots[slotIdx];
            slot.subTeams.forming++;
            slot.subTeams.estimated = slot.subTeams.forming * (CAPTAIN_CONFIG.packagePrice * 7 * CAPTAIN_CONFIG.teamRoyaltyRate);
            captainState.totalFormingTeams++;
            switchView('captain');
            showToast(t('toast.formingAdded'), 'success');
        }

        function completeTeam(teamIdx, slotIdx) {
            const slot = captainState.teams[teamIdx].slots[slotIdx];
            
            if (slot.subTeams.forming === 0) {
                showToast(t('toast.noFormingTeams'), 'warning');
                return;
            }
            
            slot.subTeams.forming--;
            slot.subTeams.completed++;
            captainState.totalFormingTeams--;
            captainState.totalCompletedTeams++;
            
            const teamRoyalty = CAPTAIN_CONFIG.packagePrice * 7 * CAPTAIN_CONFIG.teamRoyaltyRate;
            slot.subTeams.revenue += teamRoyalty;
            slot.subTeams.estimated = slot.subTeams.forming * teamRoyalty;
            
            captainState.revenue.royalty += teamRoyalty;
            captainState.revenue.total += teamRoyalty;
            
            calculateUplineRoyalty(teamIdx, slotIdx, teamRoyalty);
            
            switchView('captain');
            showToast(t('toast.teamCompleted') + ' +$' + teamRoyalty, 'success');
        }

        function calculateUplineRoyalty(teamIdx, slotIdx, amount) {
            const team = captainState.teams[teamIdx];
            const slot = team.slots[slotIdx];
            
            if (slot.role.startsWith('B')) {
                const parentIdx = slot.parent;
                const parentSlot = team.slots[parentIdx];
                parentSlot.downlineRevenue = (parentSlot.downlineRevenue || 0) + (CAPTAIN_CONFIG.packagePrice * 7 * CAPTAIN_CONFIG.teamRoyaltyRate);
                captainState.revenue.royalty += (CAPTAIN_CONFIG.packagePrice * 7 * CAPTAIN_CONFIG.teamRoyaltyRate);
                captainState.revenue.total += (CAPTAIN_CONFIG.packagePrice * 7 * CAPTAIN_CONFIG.teamRoyaltyRate);
            }
        }

        // ==================== MODALS ====================
        function openPaymentModal() {
            document.getElementById('payment-modal').classList.remove('hidden');
            document.getElementById('payment-modal').classList.add('flex');
        }

        function closePaymentModal() {
            document.getElementById('payment-modal').classList.add('hidden');
            document.getElementById('payment-modal').classList.remove('flex');
            document.getElementById('crypto-details').classList.add('hidden');
        }

        function selectCrypto(currency) {
            const address = WALLET_ADDRESSES[currency];
            document.getElementById('crypto-address').value = address;
            document.getElementById('crypto-details').classList.remove('hidden');
            showToast('Selected ' + currency, 'success');
        }

        function copyCryptoAddress() {
            const input = document.getElementById('crypto-address');
            input.select();
            navigator.clipboard.writeText(input.value);
            showToast(t('toast.copied'), 'success');
        }

        function confirmPayment() {
            closePaymentModal();
            
            setTimeout(() => {
                state.aifBalance = 10000;
                showToast(t('toast.paymentSuccess'), 'success');
                
                setTimeout(() => {
                    switchView('captain');
                }, 2000);
            }, 1000);
        }

        function activateModule(moduleId) {
            if (state.modules[moduleId]) {
                switchView(moduleId);
                return;
            }
            
            const modal = document.getElementById('verify-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            setTimeout(() => {
                const steps = modal.querySelectorAll('#verify-steps div');
                steps[0].querySelector('i').className = 'fas fa-check-circle text-green-500';
            }, 800);
            
            setTimeout(() => {
                const steps = modal.querySelectorAll('#verify-steps div');
                steps[1].querySelector('i').className = 'fas fa-check-circle text-green-500';
            }, 1600);
            
            setTimeout(() => {
                const steps = modal.querySelectorAll('#verify-steps div');
                steps[2].querySelector('i').className = 'fas fa-check-circle text-green-500';
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                    
                    state.modules[moduleId] = true;
                    
                    const navBtn = document.getElementById('nav-' + moduleId);
                    navBtn.querySelector('.module-lock').classList.add('hidden');
                    navBtn.querySelector('.module-check').classList.remove('hidden');
                    navBtn.classList.remove('opacity-50');
                    
                    showToast(t('toast.moduleActivated'), 'success');
                    switchView(moduleId);
                }, 800);
            }, 2400);
        }

        // ==================== UTILS ====================
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toast-icon');
            const msg = document.getElementById('toast-message');
            
            icon.className = type === 'warning' ? 'fas fa-exclamation-triangle' : 'fas fa-check-circle';
            msg.textContent = message;
            
            toast.classList.remove('hidden');
            toast.classList.add('flex');
            
            setTimeout(() => {
                toast.classList.add('hidden');
                toast.classList.remove('flex');
            }, 3000);
        }

        // ==================== 初始化 ====================
        updateLanguage();
        
        // 监听回车键提交邮箱
        document.getElementById('email-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loginWithEmail();
            }
        });
        
        // 监听验证码输入
        document.getElementById('verify-code').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                verifyEmailCode();
            }
        });
        
        // 自动格式化验证码输入（只允许数字）
        document.getElementById('verify-code').addEventListener('input', (e) => {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
        });
    </script>
</body>
</html>
